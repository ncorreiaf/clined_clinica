{% extends "base.html" %}

{% block title %}Avaliar Satisfação - {{ config.CLINIC_NAME }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>
                <i class="fas fa-star text-warning me-2"></i>
                Avaliação de Satisfação
            </h2>
            <a href="{{ url_for('relatorios.nps') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>Voltar
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="fas fa-clipboard-check me-2"></i>
                    Avaliação do Atendimento
                </h5>
            </div>
            <div class="card-body">
                <!-- Informações do atendimento -->
                <div class="alert alert-info">
                    <h6 class="alert-heading">Dados do Atendimento</h6>
                    <p class="mb-1"><strong>Paciente:</strong> {{ agendamento.paciente_ref.nome }}</p>
                    <p class="mb-1"><strong>Profissional:</strong> {{ agendamento.profissional_ref.nome }}</p>
                    <p class="mb-1"><strong>Serviço:</strong> {{ agendamento.servico }}</p>
                    <p class="mb-0"><strong>Data:</strong> {{ agendamento.data_agendamento.strftime('%d/%m/%Y %H:%M') }}</p>
                </div>
                
                <form method="POST">
                    <div class="mb-4">
                        <label class="form-label">
                            <strong>Em uma escala de 0 a 10, o quanto você recomendaria nossos serviços para um amigo ou familiar? *</strong>
                        </label>
                        <div class="row mt-3">
                            {% for i in range(11) %}
                            <div class="col-1 text-center">
                                <input type="radio" class="btn-check" name="nota_nps" id="nota{{ i }}" value="{{ i }}" required>
                                <label class="btn btn-outline-primary btn-sm w-100" for="nota{{ i }}">{{ i }}</label>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="row mt-2">
                            <div class="col-6 text-start">
                                <small class="text-muted">Muito improvável</small>
                            </div>
                            <div class="col-6 text-end">
                                <small class="text-muted">Muito provável</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="comentario" class="form-label">
                            <strong>Comentários ou sugestões (opcional)</strong>
                        </label>
                        <textarea class="form-control" id="comentario" name="comentario" rows="4" 
                                  placeholder="Conte-nos sobre sua experiência, o que podemos melhorar..."></textarea>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-warning">
                            <i class="fas fa-paper-plane me-1"></i>Enviar Avaliação
                        </button>
                        <button type="reset" class="btn btn-secondary">
                            <i class="fas fa-eraser me-1"></i>Limpar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Sobre o NPS
                </h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6 class="text-success">Promotores (9-10)</h6>
                    <p class="small text-muted">
                        Clientes satisfeitos que recomendariam nossos serviços.
                    </p>
                </div>
                
                <div class="mb-3">
                    <h6 class="text-warning">Neutros (7-8)</h6>
                    <p class="small text-muted">
                        Clientes satisfeitos mas não entusiasmados.
                    </p>
                </div>
                
                <div class="mb-3">
                    <h6 class="text-danger">Detratores (0-6)</h6>
                    <p class="small text-muted">
                        Clientes insatisfeitos que podem prejudicar nossa reputação.
                    </p>
                </div>
                
                <hr>
                <p class="small text-muted">
                    Sua opinião é muito importante para melhorarmos continuamente nossos serviços.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Adicionar feedback visual para as notas
    const radioButtons = document.querySelectorAll('input[name="nota_nps"]');
    radioButtons.forEach(radio => {
        radio.addEventListener('change', function() {
            const nota = parseInt(this.value);
            const labels = document.querySelectorAll('label[for^="nota"]');
            
            labels.forEach((label, index) => {
                label.classList.remove('btn-success', 'btn-warning', 'btn-danger', 'btn-outline-primary');
                
                if (index <= nota) {
                    if (nota >= 9) {
                        label.classList.add('btn-success');
                    } else if (nota >= 7) {
                        label.classList.add('btn-warning');
                    } else {
                        label.classList.add('btn-danger');
                    }
                } else {
                    label.classList.add('btn-outline-primary');
                }
            });
        });
    });
});
</script>
{% endblock %}